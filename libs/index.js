!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=12)}([function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[i].concat(o).concat([s]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];null!=o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];null!=r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(t,e,i){var n,s,o={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},h=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,d=0,u=[],l=i(8);function v(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=o[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(w(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(w(n.parts[r],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function p(t,e){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function g(t,e){var i=h(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=u[u.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),u.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=h(t.insertAt.before,i);i.insertBefore(e,s)}}function f(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function m(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return x(e,t.attrs),g(t,e),e}function x(t,e){Object.keys(e).forEach((function(i){t.setAttribute(i,e[i])}))}function w(t,e){var i,n,s,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=d++;i=c||(c=m(e)),n=C.bind(null,i,r,!1),s=C.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",x(e,t.attrs),g(t,e),e}(e),n=P.bind(null,i,e),s=function(){f(i),i.href&&URL.revokeObjectURL(i.href)}):(i=m(e),n=E.bind(null,i),s=function(){f(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=p(t,e);return v(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var r=i[s];(a=o[r.id]).refs--,n.push(a)}t&&v(p(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var y,b=(y=[],function(t,e){return y[t]=e,y.filter(Boolean).join("\n")});function C(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=b(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function E(t,e){var i=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}function P(t,e,i){var n=i.css,s=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||o)&&(n=l(n)),s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}},function(t,e,i){var n=i(7);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){"use strict";(function(t){var i=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,n){return t[0]===e&&(i=n,!0)})),i}return(function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];t.call(e,s[1],s[0])}},e}())}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,s=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(s):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)},r=2;var a=20,h=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,d=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,n=!1,s=0;function a(){i&&(i=!1,t()),n&&c()}function h(){o(a)}function c(){var t=Date.now();if(i){if(t-s<r)return;n=!0}else i=!0,n=!1,setTimeout(h,e);s=t}return c}(this.refresh.bind(this),a)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;h.some((function(t){return!!~i.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},l=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||s},v=w(0,0,0,0);function p(t){return parseFloat(t)||0}function g(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce((function(e,i){return e+p(t["border-"+i+"-width"])}),0)}function f(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return v;var n=l(t).getComputedStyle(t),s=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],o=t["padding-"+s];e[s]=p(o)}return e}(n),o=s.left+s.right,r=s.top+s.bottom,a=p(n.width),h=p(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==e&&(a-=g(n,"left","right")+o),Math.round(h+r)!==i&&(h-=g(n,"top","bottom")+r)),!function(t){return t===l(t).document.documentElement}(t)){var c=Math.round(a+o)-e,d=Math.round(h+r)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(d)&&(h-=d)}return w(s.left,s.top,a,h)}var m="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof l(t).SVGGraphicsElement}:function(t){return t instanceof l(t).SVGElement&&"function"==typeof t.getBBox};function x(t){return n?m(t)?function(t){var e=t.getBBox();return w(0,0,e.width,e.height)}(t):f(t):v}function w(t,e,i,n){return{x:t,y:e,width:i,height:n}}var y=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=w(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=x(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(t,e){var i,n,s,o,r,a,h,c=(n=(i=e).x,s=i.y,o=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),u(h,{x:n,y:s,width:o,height:r,top:s,right:n+o,bottom:r+s,left:n}),h);u(this,{target:t,contentRect:c})},C=function(){function t(t,e,n){if(this.activeObservations_=[],this.observations_=new i,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new b(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),E="undefined"!=typeof WeakMap?new WeakMap:new i,P=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=d.getInstance(),n=new C(e,i,this);E.set(this,n)};["observe","unobserve","disconnect"].forEach((function(t){P.prototype[t]=function(){var e;return(e=E.get(this))[t].apply(e,arguments)}}));var M=void 0!==s.ResizeObserver?s.ResizeObserver:P;e.a=M}).call(this,i(9))},function(t,e,i){var n=i(10);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){var n=i(11);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".rectDomNode-1PZoh {\n  position: absolute;\n  top: 0;\n  left: 0;\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n  z-index: 0;\n}\n",""]),e.locals={node:"rectDomNode-1PZoh"}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var s,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")}))}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".ContextMenu-Xw6ES {\n  background: white;\n  position: fixed;\n  width: 160px;\n  min-height: 160px;\n  border-radius: 5px;\n  z-index: 9999;\n  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n  border: 1px solid rgba(0, 0, 0, 0.15);\n  font-size: 14px;\n  padding: 10px 0;\n  color: #666;\n}\n.ContextMenu-Xw6ES .item {\n  height: 26px;\n  line-height: 26px;\n  padding: 0 20px;\n  cursor: pointer;\n}\n.ContextMenu-Xw6ES .item:hover {\n  background: #f6f6f6;\n  color: #0796e9;\n}\n",""]),e.locals={menu:"ContextMenu-Xw6ES"}},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".canvas-EKqII {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  overflow: hidden;\n}\n.canvas-EKqII canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n.canvas-EKqII .hidden {\n  display: none !important;\n}\n",""]),e.locals={topology:"canvas-EKqII"}},function(t,e,i){"use strict";i.r(e);var n=i(0),s=i.n(n);class o{constructor(){s()(this,"events",{})}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){if(!this.events[t])return;const i=this.events[t].findIndex(t=>t===e);this.events[t].splice(i,1)}emit(t,e){this.events[t]&&this.events[t].forEach(t=>{t(e)})}clear(){Object.keys(this.events).forEach(t=>{delete this.events[t]})}}var r=o;class a{static copy(t){return t.clone()}constructor(t=0,e=0){s()(this,"x",void 0),s()(this,"y",void 0),this.x=t,this.y=e}get magnitude(){return this.getMagnitude()}getMagnitude(){return 0===this.x&&0===this.y?1e-9:Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return this.x*t.x+this.y*t.y}crossProduct(t){return this.x*t.y-this.y*t.x}scale(t){return this.x*=t,this.y*=t,this}edge(t){return this.clone().substract(t)}perpendicular(){return new a(this.y,-this.x)}normalize(){const t=this.getMagnitude();return new a(this.x/t,this.y/t)}normal(){return this.perpendicular().normalize()}cosAngle(t){return this.dotProduct(t)/(this.magnitude*t.magnitude)}angle(t){return Math.acos(this.cosAngle(t))}xAxisAngle(){const t=this.angle(a.xAxis);return this.y>0?t:-t}rotate(t){const{x:e,y:i}=this;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this}project(t){const e=this.dotProduct(t)/t.magnitude;return t.normalize().scale(e)}equal(t){return this.x===t.x&&this.y===t.y}distance(t){return Math.sqrt(this.squareDistance(t))}squareDistance(t){return(this.x-t.x)**2+(this.y-t.y)**2}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return new a(this.x,this.y)}}s()(a,"xAxis",new a(1,0)),s()(a,"yAxis",new a(0,1));var h=a;let c=1;var d=class{get visible(){return this._visible}set visible(t){this._visible=t}get text(){return this._text}set text(t){this._text=t,this.canvas&&(this.canvas.repaint=!0)}get miniMapVisible(){return this.visible}constructor(t){s()(this,"canvas",void 0),s()(this,"active",!1),s()(this,"_visible",void 0),s()(this,"_text",void 0),s()(this,"zIndex",void 0),s()(this,"isUpdate",!0),s()(this,"graphId",c++),s()(this,"data",null),s()(this,"style",{color:"#29c1f8",activeColor:"#e96160",lineWidth:2}),s()(this,"renderSign",void 0),this._visible=t.visible||!0,this._text=t.text||"",this.zIndex=t.zIndex||0,this.data=t.data}isInRect(t){return!1}isWrappedInRect(t){return!1}isWrappedInCircle(){return!1}render(t){}update(t){}destroy(){}beforeDestroy(){}exportJson(){}};class u extends d{getPosition(){return this.position}get visible(){return!!this._visible&&!!(!this.parent||this.parent.visible&&this.parent.isExpanded)}set visible(t){this._visible=t}get miniMapVisible(){return!!(!this.parent||this.parent.miniMapVisible&&this.parent.isExpanded)}get text(){return this._text}set text(t){this._text=t,this.render(),this.canvas&&(this.canvas.repaint=!0)}constructor(t){super(t),s()(this,"id",void 0),s()(this,"position",void 0),s()(this,"mounted",!1),s()(this,"renderType",void 0),s()(this,"shapeType",void 0),s()(this,"isGroup",!1),s()(this,"isExpanded",!0),s()(this,"canResize",!1),s()(this,"children",[]),s()(this,"parent",void 0),s()(this,"edges",[]),this.position=new h(t.x,t.y),this.id=t.id}translate(t){this.position.add(t),this.isUpdate=!0,this.children.forEach(e=>{e.translate(t)})}addEdge(t){this.edges.find(e=>e===t)||this.edges.push(t)}removeEdge(t){const e=this.edges.findIndex(e=>e===t);e>-1&&this.edges.splice(e,1)}addChild(t){if(t.hasDescendant(this))return;if(this.hasChild(t))return;let e=this.children.length-1,i=this.children[e];for(;i;){if(i.zIndex<=t.zIndex)return this.addChildAt(t,e+1);e--,i=this.children[e]}return this.addChildAt(t,0)}addChildAt(t,e){return e>=0&&e<=this.children.length?(t.parent&&t.parent.removeChild(t,!1),t.parent=this,this.children.splice(e,0,t),this.canvas&&(t.canvas=this.canvas,t.render(),t.getDescendantBF(t=>{t.canvas=this.canvas,t.render()})),t):void 0}removeChild(t,e=!0){const i=this.children.findIndex(e=>e===t);return-1!==i&&(e&&t.destroy(),t.canvas=void 0,this.children.splice(i,1),!0)}removeAllChild(t=!0){[...this.children].forEach(e=>{this.removeChild(e,t)})}hasChild(t){return!!this.children.find(e=>e===t)}hasDescendant(t){let e=!1;return this.getDescendantBF(i=>{if(i===t)return e=!0}),e}hasActiveAncestor(){return!!this.parent&&(this.parent.active||this.parent.hasActiveAncestor())}getActiveChild(){return this.children.filter(t=>t.active)}getActiveDescendant(){const t=[];return this.getDescendantBF(e=>{e.active&&t.push(e)}),t}getDescendantDF(t){let e=!1;const i=[];return function t(n){for(let s=this.children.length-1;s>=0;s--){const o=this.children[s];if(t.call(o,n),e)return i;if(i.push(o),n&&n(o))return e=!0,i}return i}.call(this,t)}getDescendantBF(t){const e=[],i=[...this.children];for(;i.length;){const n=i.shift();if(e.push(n),i.push(...n.children),t&&t(n))break}return e}get root(){return this.parent?this.parent.root:this}get depth(){return this.parent?this.parent.depth+1:0}get firstChild(){return this.children[0]}get lastChild(){return this.children[this.children.length-1]}mount(t=!1){}unmount(){}destroy(){this.removeAllChild(),this.beforeDestroy(),this.unmount()}}var l=u;class v{static isPointInRect(t,e,i,n){return!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+i)&&!(t.y>e.y+n)))}static isPointInCircle(t,e,i){return h.copy(e).substract(t).magnitude<=i}static isPointInTriangle(t,e,i,n){const s=h.copy(e).substract(t),o=h.copy(i).substract(t),r=h.copy(n).substract(t),a=s.crossProduct(o)<0,c=o.crossProduct(r)<0,d=r.crossProduct(s)<0;return a===c&&c===d}static isPointInPolygon(t,e){if(e.length<3)return!1;for(let i=2;i<e.length;i++)if(v.isPointInTriangle(t,e[0],e[i-1],e[i]))return!0;return!1}static isPointInLineSegment(t,e,i=.01){const n=e[0],s=e[1],o=h.copy(t).substract(n),r=h.copy(t).substract(s),a=h.copy(n).substract(s);return o.magnitude+r.magnitude-a.magnitude<i}static isPointInPolyline(t,e,i=.01){const n=e.length;if(n<2)return!1;for(let s=1;s<n;s++)if(v.isPointInLineSegment(t,[e[s-1],e[s]],i))return!0;return!1}static isIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1];if(v.isPointInLineSegment(i,e))return!0;if(v.isPointInLineSegment(n,e))return!0;if(v.isPointInLineSegment(s,t))return!0;if(v.isPointInLineSegment(o,t))return!0;const r=h.copy(s).substract(i),a=h.copy(o).substract(i),c=h.copy(s).substract(n),d=h.copy(o).substract(n);if(r.crossProduct(a)<0===c.crossProduct(d)<0)return!1;const u=h.copy(i).substract(s),l=h.copy(n).substract(s),p=h.copy(i).substract(o),g=h.copy(n).substract(o);return u.crossProduct(l)<0!==p.crossProduct(g)<0}static getLineIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1],r=h.copy(n).substract(i),a=h.copy(o).substract(s).perpendicular(),c=s.project(a),d=i.project(a),u=n.project(a),l=h.copy(c).substract(d),v=h.copy(u).substract(c),p=r.magnitude*l.magnitude/(l.magnitude+v.magnitude);return r.normalize().scale(p).add(i)}static getLinePoint(t,e){const i=t.length;if(i<2)return null;e>1&&(e=1),e<0&&(e=0);const n=v.getPolyLineLength(t)*e;let s=0;for(let e=1;e<i;e++)if(s+=t[e].distance(t[e-1]),s>=n){const i=s-n;return h.copy(t[e]).add(h.copy(t[e-1]).substract(t[e]).normalize().scale(i))}return new h(0,0)}static getPolyLineLength(t){const e=t.length;if(e<2)return 0;let i=0;for(let n=1;n<e;n++)i+=t[n].distance(t[n-1]);return i}}var p=v;var g=class extends l{constructor(t){super(t),s()(this,"shapeType","rect"),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"minWidth",void 0),s()(this,"minHeight",void 0),s()(this,"collapseWidth",50),s()(this,"collapseHeight",50),this.width=t.width||100,this.height=t.height||100,this.minWidth=t.minWidth||30,this.minHeight=t.minHeight||30}get vertexes(){return this.getBoundingRect()}get boundingRect(){return this.getBoundingRect()}get boundingJoinPoints(){return this.getBoundingJoinPoints()}get centerPoint(){return this.getCenterPoint()}get circumradius(){const t=this.getWidth(),e=this.getHeight();return Math.sqrt(t**2+e**2)/2}getPosition(){if(this.isExpanded)return this.position;{const{x:t,y:e}=this.position;return new h(t+(this.width-this.collapseWidth)/2,e+(this.height-this.collapseHeight)/2)}}getWidth(){return this.isExpanded?this.width:this.collapseWidth}getHeight(){return this.isExpanded?this.height:this.collapseHeight}isPointIn(){const{canvas:t}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const e=t.nativeEvent,i=t.viewportToPixelCoordinate(new h(e.clientX,e.clientY));return p.isPointInRect(i,this.getPosition(),this.getWidth(),this.getHeight())}get joinPoint(){const{x:t,y:e}=this.getPosition();return new h(t+this.getWidth()/2,e+this.getHeight()/2)}getBoundingRect(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new h(i,n),new h(i+t,n),new h(i+t,n+e),new h(i,n+e)]}getBoundingJoinPoints(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new h(i+t/2,n),new h(i+t,n+e/2),new h(i+t/2,n+e),new h(i,n+e/2)]}getCenterPoint(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return new h(i+t/2,n+e/2)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x)&&(!(t[2].x<e[0].x)&&(!(t[0].y>e[2].y)&&!(t[2].y<e[0].y)))}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.fillStyle=this.active?this.style.activeColor:this.style.color,t.fill(),t.restore()}};var f=class extends l{get boundingJoinPoints(){return this.getBoundingJoinPoints()}get boundingRect(){return this.getBoundingRect()}get centerPoint(){return this.getCenterPoint()}get vertexes(){return this.getBoundingRect()}get circumradius(){return this.radius}constructor(t){super(t),s()(this,"shapeType","circle"),s()(this,"radius",void 0),s()(this,"minRadius",void 0),s()(this,"text",void 0),this.radius=t.radius||50,this.minRadius=t.minRadius||30,this.text=t.text||""}isPointIn(){const{canvas:t,centerPoint:e,radius:i}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const n=t.nativeEvent,s=t.viewportToPixelCoordinate(new h(n.clientX,n.clientY));return p.isPointInCircle(s,e,i)}getBoundingRect(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new h(e,i),new h(e+n,i),new h(e+n,i+n),new h(e,i+n)]}getBoundingJoinPoints(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new h(e+t,i),new h(e+n,i+t),new h(e+t,i+n),new h(e,i+t)]}getCenterPoint(){const{position:{x:t,y:e},radius:i}=this;return new h(t+i,e+i)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x)&&(!(t[2].x<e[0].x)&&(!(t[0].y>e[2].y)&&!(t[2].y<e[0].y)))}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}drawThumbnail(t){const{x:e,y:i}=this.centerPoint;t.save(),t.beginPath(),t.arc(e,i,this.radius,0,2*Math.PI),t.fillStyle=this.active?this.style.activeColor:this.style.color,t.fill(),t.restore()}},m=i(3),x=i.n(m);class w extends g{constructor(t){super(t),s()(this,"renderType","DOM"),s()(this,"$el",document.createElement("div")),this.$el.className=x.a.node}mount(t=!1){this.mounted&&!t||this.canvas&&(this.mounted=!0,this.canvas.wrapper.appendChild(this.$el))}unmount(){this.mounted&&this.canvas&&(this.mounted=!1,this.$el.parentElement&&this.$el.parentElement.removeChild(this.$el))}render(t){this.$el.innerHTML=`<div style="height:100%;\n                                      display:flex;\n                                      align-items:center;\n                                      justify-content:center;\n                                      border:1px solid #29c1f8;\n                                      box-sizing: border-box;\n                                      font-size:12px;\n                                      user-select: none;\n                                      color:#29c1f8;">${this.text}</div>`}update(t){if(!this.canvas)return;const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();Object.assign(this.$el.style,{transform:`scale(${this.canvas.canvasScale}) translate3d(${e}px,${i}px,0)`,width:`${n}px`,height:`${s}px`,boxShadow:this.active?`0 0 5px 0 ${this.style.activeColor}`:"none"})}}var y=w;class b extends y{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(){this.$el.innerHTML=`<div style="height:100%;\n                                      display:flex;\n                                      align-items:center;\n                                      justify-content:center;\n                                      border:1px solid #066df2;\n                                      box-sizing:border-box;">\n                            ${this.isExpanded?"":"..."}\n                          </div>`}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}var C=b;function E(t){let e=!1;return function(...i){e||(e=!0,t(...i),requestAnimationFrame(()=>{e=!1}))}}function P(t){return new Promise((e,i)=>{const n=new Image;n.src=t,n.onload=()=>{e(n)},n.onerror=()=>{i()}})}function M(t,e){e.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{"constructor"!==i&&(t.prototype[i]=e.prototype[i])})})}function N(t){return t instanceof g}function A(t){return t instanceof f}function I(t){return t instanceof C}var _=i(4);var T=class extends l{constructor(t){super(t),s()(this,"maxDepth",!1),s()(this,"renderType","NONE"),s()(this,"shapeType","circle"),s()(this,"radius",1)}get vertexes(){return this.boundingRect}get boundingRect(){const{x:t,y:e}=this.position;return[new h(t-this.radius,e-this.radius),new h(t+this.radius,e-this.radius),new h(t+this.radius,e+this.radius),new h(t-this.radius,e+this.radius)]}get boundingJoinPoints(){const{x:t,y:e}=this.position;return[new h(t,e-this.radius),new h(t+this.radius,e),new h(t,e+this.radius),new h(t-this.radius,e)]}get joinPoint(){return this.position}get centerPoint(){return this.position}get depth(){return this.maxDepth?Number.MAX_SAFE_INTEGER:this.parent?this.parent.depth+1:0}get circumradius(){return this.radius}isInRect(){return!1}isPointIn(){return!1}render(){}destroy(){}updatePosition(){}updateRender(){}drawThumbnail(){}};function S(t,e){}class R{constructor(){s()(this,"onInstall",S),s()(this,"onUninstall",S),s()(this,"onUpdate",S)}handleEvent(t,e){}}var k=R;class D extends k{constructor(t){super(),s()(this,"minDragDistance",3),s()(this,"moveNodes",[]),s()(this,"mousedown",!1),s()(this,"lastCoordinate",new h),s()(this,"yLocked",!1),s()(this,"yAlign","center"),s()(this,"yValue",0),s()(this,"xLocked",!1),s()(this,"xAlign","center"),s()(this,"xValue",0),s()(this,"alignEnable",!0),s()(this,"alignGap",10),s()(this,"alignLineColor","#2EB5E5"),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseDown",t=>{const e=t.getActiveNodes();e.length?this.moveNodes=[...e]:this.moveNodes=[...t.rootNode.children],this.mousedown=!0,this.yLocked=!1,this.xLocked=!1,this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mousedown)return;if(h.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=h.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.moveNodes.forEach(t=>{t.translate(i)}),this.autoAlign(t),t.repaint=!0}),s()(this,"onMouseUp",t=>{const{topCanvasCtx:e,viewWidth:i,viewHeight:n}=t;this.joinGroupComplete(t),this.autoAlignComplete(),this.moveNodes=[],this.mousedown=!1,e.clearRect(0,0,i,n),t.repaint=!0}),t&&(void 0!==t.alignEnable&&(this.alignEnable=t.alignEnable),void 0!==t.alignGap&&(this.alignGap=t.alignGap),t.alignLineColor&&(this.alignLineColor=t.alignLineColor))}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t);break;case"mouseup":this.onMouseUp(t)}}joinGroupComplete(t){if(1!==this.moveNodes.length)return;const e=this.moveNodes[0];let i=!1;t.rootNode.getDescendantDF(t=>{if(t.visible&&t!==e&&t.isGroup&&!e.hasDescendant(t))return e.isWrappedInRect(t.boundingRect)?(t.addChild(e),i=!0):void 0}),i||t.rootNode.addChild(e)}autoAlign(t){if(!this.alignEnable)return;if(1!==this.moveNodes.length)return;this.yLocked=!1,this.xLocked=!1;const e=this.moveNodes[0];if(e.parent){const{topCanvasCtx:i,viewWidth:n,viewHeight:s}=t;i.clearRect(0,0,n,s),i.beginPath();const o=e.boundingJoinPoints,r=e.centerPoint,a=[o[0].y,o[2].y],h=[o[3].x,o[1].x];e.parent.children.find(n=>{if(n===e)return;if(!n.visible)return;const s=n.boundingJoinPoints,o=n.centerPoint;if(!this.yLocked&&this.isClose(r.y,o.y)){const e=t.pixelToCanvasCoordinate(o);W(i,e.y),this.yLocked=!0,this.yValue=o.y,this.yAlign="center"}if(!this.yLocked){const e=[s[0],s[2]];a.find((n,s)=>{const o=e.find(t=>this.isClose(n,t.y));if(o){const e=t.pixelToCanvasCoordinate(o);W(i,e.y),this.yLocked=!0,this.yValue=o.y,this.yAlign=0===s?"top":"bottom"}return this.yLocked})}if(!this.xLocked&&this.isClose(r.x,o.x)){const e=t.pixelToCanvasCoordinate(o);L(i,e.x),this.xLocked=!0,this.xValue=o.x,this.xAlign="center"}if(!this.xLocked){const e=[s[3],s[1]];h.find((n,s)=>{const o=e.find(t=>this.isClose(n,t.x));if(o){const e=t.pixelToCanvasCoordinate(o);L(i,e.x),this.xLocked=!0,this.xValue=o.x,this.xAlign=0===s?"left":"right"}return this.xLocked})}return this.xLocked&&this.yLocked}),i.save(),i.strokeStyle=this.alignLineColor,i.lineWidth=1,i.setLineDash([5,3]),i.stroke(),i.restore()}}autoAlignComplete(){if(!this.alignEnable)return;if(1!==this.moveNodes.length)return;const t=this.moveNodes[0],[e,i,n,s]=t.boundingJoinPoints,o=t.centerPoint,r=new h;if(this.yLocked)switch(this.yAlign){case"center":r.y=this.yValue-o.y;break;case"bottom":r.y=this.yValue-n.y;break;case"top":r.y=this.yValue-e.y}if(this.xLocked)switch(this.xAlign){case"center":r.x=this.xValue-o.x;break;case"left":r.x=this.xValue-s.x;break;case"right":r.x=this.xValue-i.x}t.translate(r)}isClose(t,e){return Math.abs(t-e)<=this.alignGap}}function L(t,e){t.moveTo(e,0),t.lineTo(e,t.canvas.height)}function W(t,e){t.moveTo(0,e),t.lineTo(t.canvas.width,e)}const O=new D;var H=D;class z extends k{constructor(...t){super(...t),s()(this,"onDrop",(t,e)=>{const i=e;t.eventEmitter.emit("canvas:drop",{coordinate:t.viewportToPixelCoordinate(new h(i.clientX,i.clientY)),dataTransfer:i.dataTransfer})}),s()(this,"onDragOver",(t,e)=>{e.preventDefault()})}handleEvent(t,e){switch(e.type){case"drop":this.onDrop(t,e);break;case"dragover":this.onDragOver(t,e)}}}const B=new z;var U=z;class j extends k{constructor(...t){super(...t),s()(this,"minDragDistance",3),s()(this,"mouseDown",!1),s()(this,"move",!1),s()(this,"lastCoordinate",new h),s()(this,"onMouseDown",t=>{this.mouseDown=!0,this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mouseDown)return;if(h.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=h.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition),this.move=!0;const i=e.scale(1/t.canvasScale);t.rootNode.translate(i),t.repaint=!0}),s()(this,"onMouseUp",t=>{this.mouseDown=!1,this.move&&(t.eventEmitter.emit("interaction:canvasMoveEnd"),this.move=!1)})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t);break;case"mouseup":this.onMouseUp(t)}}}const F=new j;var G=j;class J extends k{constructor(...t){super(...t),s()(this,"onWheel",(t,e)=>{const{deltaY:i,clientX:n,clientY:s}=e;e.preventDefault(),i>0?t.zoomOut(new h(n,s)):t.zoomIn(new h(n,s))})}handleEvent(t,e){switch(e.type){case"wheel":this.onWheel(t,e)}}}const V=new J;var $=J;class q extends k{constructor(...t){super(...t),s()(this,"onMouseDown",t=>{let e,i;const n=Math.random();t.rootNode.getDescendantDF(s=>{e||i||!s.visible?s.active=!1:(s.active=s.isPointIn(),s.active&&(e=s,t.setNodeTop(s))),s.isUpdate=!0,s.edges.forEach(t=>{t.renderSign!==n&&(t.renderSign=n,t.active=!1,i||e||(t.sourceNode.visible||t.targetNode.visible)&&(t.active=t.isPointIn(),t.active&&(i=t)))})}),t.repaint=!0})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t)}}}const X=new q;var Y=q;class K extends k{constructor(...t){super(...t),s()(this,"minDragDistance",5),s()(this,"mouseDown",!1),s()(this,"activeNodes",[]),s()(this,"dragMove",!1),s()(this,"lastCoordinate",new h),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseDown",(t,e)=>{this.dragMove=!1,this.lastCoordinate.copy(t.mousedownPosition);const i=t.getActiveNodes();i.length&&i.find(t=>t.visible&&t.isPointIn())?(this.dragMove=!0,this.activeNodes=i):(this.activeNodes=[],t.rootNode.getDescendantDF(t=>{t.isUpdate=!0,!this.activeNodes.length&&t.visible&&t.isPointIn()?(this.activeNodes.push(t),this.dragMove=!0,t.active=!0):t.active=!1}),t.repaint=!0),this.mouseDown=!0,t.topCanvasCtx.fillStyle="rgba(41, 193, 248, 0.3)",t.topCanvasCtx.strokeStyle="rgb(41, 193, 248)"}),s()(this,"onMouseMove",(t,e)=>{if(this.mouseDown)if(this.dragMove){const e=h.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.activeNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}else{const{mousedownPosition:e,mousemovePosition:i,topCanvasCtx:n,viewWidth:s,viewHeight:o}=t;if(h.copy(i).substract(e).magnitude<this.minDragDistance)return;const r=t.viewportToCanvasCoordinate(e),a=t.viewportToCanvasCoordinate(i),c=new h(r.x,a.y),d=new h(a.x,r.y);let u,l,v,p;n.clearRect(0,0,s,o),n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(c.x,c.y),n.lineTo(a.x,a.y),n.lineTo(d.x,d.y),n.closePath(),n.fill(),n.stroke(),e.x>i.x?e.y>i.y?(u=t.viewportToPixelCoordinate(i),v=t.viewportToPixelCoordinate(e),l=new h(v.x,u.y),p=new h(u.x,v.y)):(l=t.viewportToPixelCoordinate(e),p=t.viewportToPixelCoordinate(i),u=new h(p.x,l.y),v=new h(l.x,p.y)):e.y>i.y?(l=t.viewportToPixelCoordinate(i),p=t.viewportToPixelCoordinate(e),u=new h(p.x,l.y),v=new h(l.x,p.y)):(u=t.viewportToPixelCoordinate(e),v=t.viewportToPixelCoordinate(i),l=new h(v.x,u.y),p=new h(u.x,v.y));const g=[u,l,v,p];t.rootNode.getDescendantBF(t=>{const e=t.active;t.hasActiveAncestor()?t.active=!1:t.isWrappedInRect(g)?t.active=!0:t.active=!1,e!==t.active&&(t.isUpdate=!0)}),t.repaint=!0}}),s()(this,"onMouseUp",(t,e)=>{if(!this.mouseDown)return;this.dragMove=!1;const{topCanvasCtx:i,viewWidth:n,viewHeight:s}=t;this.mouseDown=!1,i.clearRect(0,0,n,s)})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t,e);break;case"mousemove":this.onMouseMove(t,e);break;case"mouseup":this.onMouseUp(t,e)}}}const Z=new K;var Q=K;class tt extends g{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"cacheCanvas",document.createElement("canvas"))}render(t){if(!this.canvas)return;const e=this.getWidth(),i=this.getHeight();t=t||this.cacheCanvas.getContext("2d"),this.cacheCanvas.width=e+4,this.cacheCanvas.height=i+4,t.rect(2,2,e,i),t.strokeStyle="#29c1f8",t.fillStyle="#fff",t.lineWidth=1,t.fill(),t.stroke(),t.textBaseline="middle",t.textAlign="center",t.font="14px serif",t.fillStyle="#29c1f8",t.fillText(this.text,e/2+2,i/2+2),this.canvas.repaint=!0}update(t){if(!this.canvas)return;const{graphCanvasCtx:e}=this.canvas,{x:i,y:n}=this.getPosition();e.save(),this.active&&(e.shadowBlur=5,e.shadowColor="rgba(255,0,0,0.8)"),e.drawImage(this.cacheCanvas,i-2,n-2),e.restore()}}class et extends tt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(t){}update(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const e=this.getWidth(),i=this.getHeight(),{x:n,y:s}=this.getPosition(),o=this.centerPoint;t.beginPath(),t.rect(n,s,e,i),this.isExpanded||(t.moveTo(o.x,o.y-10),t.lineTo(o.x,o.y+10),t.moveTo(o.x-10,o.y),t.lineTo(o.x+10,o.y)),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor=this.active?this.style.activeColor:this.style.color),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.stroke(),t.restore()}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}s()(et,"shape","rect");var it=et;var nt=class{constructor(){s()(this,"canvas",null),s()(this,"enable",!0)}update(){}handleEvent(t){}},st=i(5),ot=i.n(st);class rt extends nt{constructor(){super(),s()(this,"position",new h),s()(this,"mounted",!1),s()(this,"container",document.createElement("div")),s()(this,"onContextMenu",()=>[]),s()(this,"menu",[]),s()(this,"hide",()=>{this.container.parentElement&&this.container.parentElement.removeChild(this.container)}),s()(this,"handleContextMenu",t=>{if(this.position.x=t.clientX,this.position.y=t.clientY,!this.canvas)return;const e=this.canvas.getActiveNodes(),i=this.canvas.getActiveEdges();let n=e.find(t=>t.isPointIn())||i.find(t=>t.isPointIn())||null;const s=this.onContextMenu(this,n,e,i);this.show(s)}),s()(this,"handleClick",t=>{if(!this.canvas)return;t.stopPropagation();const e=t.target;if(!e)return;if(e===this.container)return;const i=e.dataset.command,n=this.menu.find(t=>t.command===i);this.canvas.eventEmitter.emit("canvas:menu",n),this.hide()}),this.container.className=ot.a.menu}handleEvent(t){"contextmenu"===t.type&&this.handleContextMenu(t)}install(t){this.canvas=t,this.container.addEventListener("click",this.handleClick),document.addEventListener("click",this.hide)}destroy(){this.canvas&&(this.container.removeEventListener("click",this.handleClick),document.removeEventListener("click",this.hide),this.canvas=null)}show(t=[],e,i){if(this.hide(),this.menu=t,!t.length)return;let{x:n,y:s}=this.position;n=void 0!==e?e:n,s=void 0!==i?i:s;const o=this.menu.map(t=>`<div class="item" data-command="${t.command}">${t.label}</div>`);this.container.innerHTML=o.join(""),document.body.appendChild(this.container),Object.assign(this.container.style,{left:`${n}px`,top:`${s}px`});const r=this.container.getBoundingClientRect(),a=window.innerWidth-10,h=window.innerHeight-10,c=r.right>a?a-r.right:0,d=r.bottom>h?h-r.bottom:0;Object.assign(this.container.style,{left:`${n+c}px`,top:`${s+d}px`})}}var at=rt;class ht extends k{constructor(t){super(),s()(this,"canvas",void 0),s()(this,"parentNode",void 0),s()(this,"onCreate",void 0),s()(this,"onContextMenu",(t,e)=>{const i=t.plugins.find(t=>t instanceof at);if(!i)return;const n=t.getActiveNodes();if(n.length){this.parentNode=void 0,-1===n.findIndex(t=>!!t.parent&&(!(!this.parentNode||this.parentNode===t.parent)||(this.parentNode=t.parent,!1)))&&i.show([{label:"添加到组",command:"addToGroup"}])}}),s()(this,"onInstall",t=>{this.canvas=t,t.eventEmitter.on("canvas:menu",this.onCanvasMenu)}),s()(this,"onUninstall",t=>{t.eventEmitter.off("canvas:menu",this.onCanvasMenu)}),s()(this,"onCanvasMenu",t=>{if("addToGroup"!==t.command)return;const e=this.canvas.getActiveNodes();if(!e.length)return;const i=this.onCreate();e.forEach(t=>i.addChild(t));const{xMin:n,yMin:s,xMax:o,yMax:r}=function(t){let e=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;return t.forEach(t=>{t.boundingRect.forEach(t=>{e=Math.min(e,t.x),i=Math.min(i,t.y),n=Math.max(n,t.x),s=Math.max(s,t.y)})}),{xMin:e,yMin:i,xMax:n,yMax:s}}(e);N(i)&&(i.width=o-n+40,i.height=r-s+40),A(i),i.position.x=n-20,i.position.y=s-20,this.parentNode?(this.parentNode.addChild(i),this.canvas.setNodeTop(i),this.canvas.repaint=!0):this.canvas.addNode(i)}),this.onCreate=t||(()=>"CANVAS"===this.canvas.renderType?new it({id:Math.random()}):new C({id:Math.random()}))}handleEvent(t,e){switch(e.type){case"contextmenu":this.onContextMenu(t,e)}}}const ct=new ht;var dt=ht;const ut=new h(-3,-3);class lt extends k{constructor(...t){super(...t),s()(this,"activeNode",void 0),s()(this,"flag",!1),s()(this,"activeAnchorIndex",-1),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseUp",t=>{this.activeAnchorIndex=-1,O.onMouseUp(t)}),s()(this,"onMouseDown",t=>{if(this.activeAnchorIndex=this.getActiveAnchorIndex(t),-1===this.activeAnchorIndex){X.onMouseDown(t),O.onMouseDown(t);const e=t.getActiveNodes()[0];e&&e.canResize&&e.isExpanded?this.activeNode=e:this.activeNode=void 0}}),s()(this,"onMouseMove",(t,e)=>{const i=this.activeNode;if(this.activeAnchorIndex>-1&&i){const n=e,s=t.viewportToPixelCoordinate(new h(n.clientX,n.clientY));i.isUpdate=!0,t.repaint=!0,"rect"===i.shapeType?function(t,e,i){const n=t.boundingRect;let s=t.getWidth(),o=t.getHeight();switch(e){case 0:s=n[2].x-i.x,o=n[2].y-i.y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 1:s=i.x-n[3].x,o=n[3].y-i.y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 2:s=i.x-n[0].x,o=i.y-n[0].y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.height=o);break;case 3:s=n[1].x-i.x,o=i.y-n[1].y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.height=o);break;case 4:o=n[2].y-i.y,o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 5:s=i.x-n[0].x,s>=t.minWidth&&(t.width=s);break;case 6:o=i.y-n[0].y,o>=t.minHeight&&(t.height=o);break;case 7:s=n[2].x-i.x,s>=t.minWidth&&(t.position.x=i.x,t.width=s)}}(i,this.activeAnchorIndex,s):function(t,e,i){let n=t.radius,s=t.minRadius;const o=t.centerPoint;switch(e){case 0:case 1:case 2:case 3:n=h.copy(i).substract(o).magnitude/Math.sqrt(2);break;case 4:case 5:case 6:case 7:n=h.copy(i).substract(o).magnitude}n>=s&&(t.radius=n,t.position.y=o.y-n,t.position.x=o.x-n)}(i,this.activeAnchorIndex,s),i.render()}else{const e=this.getActiveAnchorIndex(t);let i="default";if(e>-1)switch(e){case 0:i="nwse-resize";break;case 1:i="nesw-resize";break;case 2:i="nwse-resize";break;case 3:i="nesw-resize";break;case 4:i="ns-resize";break;case 5:i="ew-resize";break;case 6:i="ns-resize";break;case 7:i="ew-resize"}else O.onMouseMove(t);t.wrapper.style.cursor=i}}),s()(this,"onUpdate",t=>{if(t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),this.activeNode){const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];t.topCanvasCtx.save(),t.topCanvasCtx.fillStyle="#2D8CF5",t.topCanvasCtx.beginPath(),e.forEach(e=>{const i=t.pixelToCanvasCoordinate(e);t.topCanvasCtx.rect(i.x-3,i.y-3,6,6),t.topCanvasCtx.fill()}),t.topCanvasCtx.restore()}})}getActiveAnchorIndex(t){if(!this.activeNode)return-1;const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];let i=0;return e.find((e,n)=>{const s=t.pixelToViewportCoordinate(e).add(ut);return i=n,p.isPointInRect(t.mousemovePosition,s,6,6)})?i:-1}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t,e);break;case"mouseup":this.onMouseUp(t)}}}const vt=new lt;var pt=lt;class gt extends k{constructor(...t){super(...t),s()(this,"lastTimestamp",0),s()(this,"onMouseDown",t=>{const e=Date.now();if(e-this.lastTimestamp<300){const e=t.getActiveNodes()[0];e&&e.isGroup&&(e.isExpanded=!e.isExpanded,e.isUpdate=!0,e.render(),t.repaint=!0)}this.lastTimestamp=e})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t)}}}const ft=new gt;var mt=gt;class xt extends d{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),this.targetNode=t.targetNode,this.sourceNode=t.sourceNode}getTargetNode(){let t=this.targetNode.parent,e=!0;for(;t;)t.isExpanded||(e=!1),t=t.parent;if(e)return this.targetNode;{let t=this.targetNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}}getSourceNode(){let t=this.sourceNode.parent,e=!0;for(;t;)t.isExpanded||(e=!1),t=t.parent;if(e)return this.sourceNode;{let t=this.sourceNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}}}var wt=class{constructor(){s()(this,"position",new h),s()(this,"offset",new h),s()(this,"rotate",0)}};class yt extends wt{constructor(t){super(),s()(this,"width",void 0),s()(this,"height",void 0),this.width=t.width,this.height=t.height}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.beginPath(),t.save(),t.translate(e,i),t.rotate(this.rotate),t.translate(n,s),t.moveTo(0,0),t.lineTo(-this.height,+this.width/2),t.lineTo(-this.height,-this.width/2),t.closePath(),t.fill(),t.restore()}isPointIn(t){const e=new h(0,0).add(this.offset).rotate(this.rotate),i=new h(-this.height,+this.width/2).add(this.offset).rotate(this.rotate),n=new h(-this.height,-this.width/2).add(this.offset).rotate(this.rotate);return p.isPointInTriangle(h.copy(t).substract(this.position),e,i,n)}}var bt=yt;class Ct extends wt{constructor(t){super(),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"fillStyle",""),s()(this,"strokeStyle",""),this.width=t.width,this.height=t.height}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.beginPath(),t.save(),t.translate(e,i),t.rotate(this.rotate),t.translate(n,s),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fillRect(-this.width/2,-this.height/2,this.width,this.height)),this.strokeStyle&&(t.strokeStyle=this.strokeStyle,t.strokeRect(-this.width/2,-this.height/2,this.width,this.height)),t.restore()}isPointIn(t){const e=new h(-this.width/2,-this.height/2).add(this.offset).rotate(this.rotate),i=new h(-this.width/2,this.height/2).add(this.offset).rotate(this.rotate),n=new h(this.width/2,this.height/2).add(this.offset).rotate(this.rotate),s=new h(this.width/2,-this.height/2).add(this.offset).rotate(this.rotate);return p.isPointInPolygon(h.copy(t).substract(this.position),[e,i,n,s])}}var Et=Ct;const Pt=document.createElement("canvas").getContext("2d");class Mt extends wt{constructor(t){super(),s()(this,"text",void 0),s()(this,"font","14px sans-serif"),s()(this,"backgroundColor",""),s()(this,"textAlign","center"),s()(this,"textBaseline","middle"),s()(this,"rectElement",new Et({width:0,height:0})),this.text=t}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.save(),this.backgroundColor&&(this.rectElement.width=this.width,this.rectElement.height=this.height,this.rectElement.fillStyle=this.backgroundColor,this.rectElement.position.copy(this.position),this.rectElement.offset.copy(this.offset),this.rectElement.rotate=this.rotate,this.rectElement.render(t)),t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.translate(e,i),t.rotate(this.rotate),t.fillText(this.text,n,s),t.restore()}get width(){return Pt.font=this.font,Pt.textAlign=this.textAlign,Pt.textBaseline=this.textBaseline,Pt.measureText(this.text).width}get height(){return Pt.font=this.font,parseInt(Pt.font)}isPointIn(t){const e=this.width,i=this.height,n=new h(-e/2,-i/2).add(this.offset).rotate(this.rotate),s=new h(-e/2,i/2).add(this.offset).rotate(this.rotate),o=new h(e/2,i/2).add(this.offset).rotate(this.rotate),r=new h(e/2,-i/2).add(this.offset).rotate(this.rotate);return p.isPointInPolygon(h.copy(t).substract(this.position),[n,s,o,r])}}var Nt=Mt;const At=new h;class It extends wt{constructor(...t){super(...t),s()(this,"points",[]),s()(this,"lineWidth",1)}render(t){if(this.points.length<2)return;const{x:e,y:i}=this.offset;t.save(),t.lineWidth=this.lineWidth,t.beginPath(),t.translate(e,i),this.points.forEach((e,i)=>{const{x:n,y:s}=e;0===i?t.moveTo(n,s):t.lineTo(n,s)}),t.stroke(),t.restore()}isPointIn(t){return p.isPointInPolyline(At.copy(t).substract(this.offset),this.points,.1)}}var _t=It;var Tt=class{constructor(){s()(this,"path",[]),s()(this,"element",null),s()(this,"duration",1e3),s()(this,"progress",0),s()(this,"_lastPoint",null)}update(t){if(!this.element)return;if(this.duration<=0)return;this.progress+=t/this.duration,this.progress%=1;const e=p.getLinePoint(this.path,this.progress);if(e){if(this._lastPoint){const t=e.clone().substract(this._lastPoint).xAxisAngle();this.element.rotate=t,this.element.position.copy(e)}this._lastPoint=e}}render(t){this.element&&(this.duration<=0||this.element.render(t))}};const St={width:8,height:10};class Rt extends xt{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"arrow",void 0),s()(this,"doubleArrow",void 0),s()(this,"begin",void 0),s()(this,"end",void 0),s()(this,"lineElement",new _t),s()(this,"sourceArrowElement",new bt(St)),s()(this,"targetArrowElement",new bt(St)),s()(this,"textElement",new Nt("")),s()(this,"animate",new Tt),this.dash=t.dash||!1,this.arrow=t.arrow||!1,this.doubleArrow=t.doubleArrow||!1,this.textElement.text=this.text,this.textElement.offset.y=-10,this.style.lineWidth=2,this.animate.element=t.animateElement||null,this.animate.duration=t.animateDuration||0}isInRect(){return!0}isPointIn(){const t=this.getTargetNode(),e=this.getSourceNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.begin||!this.end)return!1;const n=i.nativeEvent,s=new h(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(this.lineElement.isPointIn(o))return!0;if(this.doubleArrow){if(this.sourceArrowElement.isPointIn(o))return!0;if(this.targetArrowElement.isPointIn(o))return!0}else if(this.arrow&&this.targetArrowElement.isPointIn(o))return!0;return!(!this.text||!this.textElement.isPointIn(o))}render(t){const e=this.getTargetNode(),i=this.getSourceNode();if((t=t||this.canvas&&this.canvas.graphCanvasCtx)&&(i.visible||e.visible)){const n=i.centerPoint,s=e.centerPoint,o=[n,s];if(A(i)?this.begin=Dt(n,i.radius,s):this.begin=kt(o,i.boundingRect),!this.begin)return;if(A(e)?this.end=Dt(s,e.radius,n):this.end=kt(o,e.boundingRect),!this.end)return;const r=h.copy(this.end).substract(this.begin);t.save(),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.fillStyle=this.active?this.style.activeColor:this.style.color,this.dash&&t.setLineDash([4,4]),this.lineElement.lineWidth=this.style.lineWidth,this.lineElement.points=[this.begin,this.end],this.lineElement.render(t);const a=r.xAxisAngle();if(this.text){this.textElement.text=this.text;const e=h.copy(this.begin).add(h.copy(r).scale(.5));this.textElement.position.copy(e),this.textElement.rotate=-Math.PI/2<=a&&a<Math.PI/2?a:a-Math.PI,this.textElement.render(t)}this.doubleArrow?(this.sourceArrowElement.position.copy(this.begin),this.sourceArrowElement.rotate=a+Math.PI,this.sourceArrowElement.render(t),this.targetArrowElement.position.copy(this.end),this.targetArrowElement.rotate=a,this.targetArrowElement.render(t)):this.arrow&&(this.targetArrowElement.position.copy(this.end),this.targetArrowElement.rotate=a,this.targetArrowElement.render(t)),this.canvas&&(this.animate.path=[this.begin,this.end],this.animate.update(this.canvas.clock.getDelta()),this.animate.render(t)),t.restore()}}drawThumbnail(t){this.render(t)}}function kt(t,e){const i=e.length;for(let n=0;n<i;n++){const s=e[n],o=n===i-1?e[0]:e[n+1];if(p.isIntersect(t,[s,o]))return p.getLineIntersect([s,o],t)}}function Dt(t,e,i){const n=h.copy(i).substract(t);if(n.magnitude<e)return;const s=n.xAxisAngle();return h.copy(t).add(new h(e*Math.cos(s),e*Math.sin(s)))}var Lt=Rt;class Wt extends k{constructor(t){super(),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),s()(this,"edge",void 0),s()(this,"onCreate",void 0),s()(this,"onMouseUp",t=>{this.edge?(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.targetNode=t,!0}),this.targetNode&&this.sourceNode&&this.targetNode!==this.sourceNode&&!this.targetNode.hasDescendant(this.sourceNode)&&!this.sourceNode.hasDescendant(this.targetNode)?(this.edge.targetNode=this.targetNode,this.targetNode.addEdge(this.edge),t.virtualNode.removeEdge(this.edge),this.targetNode.isUpdate=!0,this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0):(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0)):(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.sourceNode=t,!0}),this.sourceNode&&(this.edge=this.onCreate(this.sourceNode,t.virtualNode),t.addEdge(this.edge))),t.repaint=!0}),s()(this,"onMouseMove",t=>{t.virtualNode.position=t.viewportToPixelCoordinate(t.mousemovePosition),this.sourceNode&&(t.virtualNode.isUpdate=!0),t.repaint=!0}),s()(this,"onUninstall",t=>{this.edge&&(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0),t.repaint=!0}),this.onCreate=t||((t,e)=>new Lt({text:"",sourceNode:t,targetNode:e,arrow:!0,dash:!1,doubleArrow:!1}))}handleEvent(t,e){switch(e.type){case"mouseup":this.onMouseUp(t);break;case"mousemove":this.onMouseMove(t)}}}var Ot=Wt;class Ht extends k{constructor(...t){super(...t),s()(this,"canvas",void 0),s()(this,"onInstall",t=>{this.canvas=t,t.eventEmitter.on("canvas:menu",this.onCanvasMenu)}),s()(this,"onUninstall",t=>{t.eventEmitter.off("canvas:menu",this.onCanvasMenu)}),s()(this,"onCanvasMenu",t=>{const e=this.canvas.rootNode.children.filter(t=>t.active),{canvasWidth:i,canvasHeight:n}=this.canvas;let s,o;e.length>1?(s=e[0].boundingJoinPoints,o=e[0].centerPoint):(s=[new h(i/2,0),new h(i,n/2),new h(i/2,n),new h(0,n/2)],o=new h(i/2,n/2)),e.forEach(e=>{const i=e.boundingJoinPoints,n=e.centerPoint,r=new h;switch(t.command){case"leftAlign":r.x=s[3].x-i[3].x;break;case"rightAlign":r.x=s[1].x-i[1].x;break;case"horizontalCenterAlign":r.x=o.x-n.x;break;case"topAlign":r.y=s[0].y-i[0].y;break;case"bottomAlign":r.y=s[2].y-i[2].y;break;case"verticalCenterAlign":r.y=o.y-n.y}e.translate(r)}),this.canvas.repaint=!0})}handleEvent(t,e){switch(e.type){case"contextmenu":this.onContextMenu(t,e)}}onContextMenu(t,e){const i=t.plugins.find(t=>t instanceof at);if(i&&t.rootNode.children.filter(t=>t.active).length){const t=[...i.menu];t.push({label:"靠左对齐",command:"leftAlign"},{label:"水平居中对齐",command:"horizontalCenterAlign"},{label:"靠右对齐",command:"rightAlign"},{label:"靠上对齐",command:"topAlign"},{label:"垂直居中对齐",command:"verticalCenterAlign"},{label:"靠下对齐",command:"bottomAlign"}),i.show(t)}}}var zt=Ht;const Bt=new a,Ut=new a,jt={width:8,height:10};class Ft extends xt{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"arrow",void 0),s()(this,"doubleArrow",void 0),s()(this,"arrowStart",void 0),s()(this,"middlePoints",[]),s()(this,"centerPoint",null),s()(this,"sourceJoinPoint",void 0),s()(this,"targetJoinPoint",void 0),s()(this,"sourceArrowElement",new bt(jt)),s()(this,"targetArrowElement",new bt(jt)),s()(this,"textElement",new Nt("")),s()(this,"lineElement",new _t),s()(this,"animate",new Tt),s()(this,"isInRect",()=>!0),this.dash=t.dash||!1,this.arrow=t.arrow||!1,this.doubleArrow=t.doubleArrow||!1,this.style.lineWidth=2,this.textElement.text=this.text,this.animate.element=t.animateElement||null,this.animate.duration=t.animateDuration||0}isPointIn(){const t=this.getSourceNode(),e=this.getTargetNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.sourceJoinPoint||!this.targetJoinPoint)return!1;const n=i.nativeEvent,s=new a(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(this.lineElement.isPointIn(o))return!0;if(this.doubleArrow){if(this.targetArrowElement.isPointIn(o))return!0;if(this.sourceArrowElement.isPointIn(o))return!0}else if(this.arrow&&this.targetArrowElement.isPointIn(o))return!0;return!(!this.text||!this.textElement.isPointIn(o))}render(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const e=this.getSourceNode(),i=this.getTargetNode();if(e.visible||i.visible){const n=e.boundingJoinPoints,s=i.boundingJoinPoints;let o=0;if(this.sourceJoinPoint=void 0,this.targetJoinPoint=void 0,n.forEach(t=>{s.forEach(e=>{const i=t.distance(e);(o>i||!this.sourceJoinPoint||!this.targetJoinPoint)&&(o=i,this.sourceJoinPoint=t,this.targetJoinPoint=e)})}),!this.sourceJoinPoint||!this.targetJoinPoint)return;const r=this.sourceJoinPoint,h=this.targetJoinPoint;Bt.copy(r);const c=Bt.substract(e.centerPoint).normalize();Ut.copy(i.centerPoint);const d=Ut.substract(h).normalize();if(1===c.x||-1===c.x)if(1===d.x||-1===d.x){const t=(r.x+h.x)/2;this.middlePoints=[new a(t,r.y),new a(t,h.y)]}else this.middlePoints=[new a(h.x,r.y)];else if(1===d.x||-1===d.x)this.middlePoints=[new a(r.x,h.y)];else{const t=(r.y+h.y)/2;this.middlePoints=[new a(r.x,t),new a(h.x,t)]}t.save(),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.fillStyle=this.active?this.style.activeColor:this.style.color,this.dash&&t.setLineDash([4,4]),this.lineElement.lineWidth=this.style.lineWidth,this.lineElement.points=[r,...this.middlePoints,h],this.lineElement.render(t),this.text&&(this.centerPoint=p.getLinePoint([r,...this.middlePoints,h],.5),this.centerPoint&&(this.textElement.text=this.text,this.textElement.font="14px sans-serif",this.textElement.backgroundColor="rgba(255,255,255,0.8)",this.textElement.position.copy(this.centerPoint),this.textElement.render(t))),this.doubleArrow?(this.arrowStart=h,this.targetArrowElement.position.copy(h),this.targetArrowElement.rotate=d.xAxisAngle(),this.targetArrowElement.render(t),this.sourceArrowElement.position.copy(r),this.sourceArrowElement.rotate=c.xAxisAngle()+Math.PI,this.sourceArrowElement.render(t)):this.arrow&&(this.arrowStart=h,this.targetArrowElement.position.copy(h),this.targetArrowElement.rotate=d.xAxisAngle(),this.targetArrowElement.render(t)),this.canvas&&(this.animate.path=[r,...this.middlePoints,h],this.animate.update(this.canvas.clock.getDelta()),this.animate.render(t)),t.restore()}}drawThumbnail(t){this.render(t)}}var Gt=Ft;const Jt="mode.default",Vt="mode.view",$t="mode.create.edge",qt="mode.create.L",Xt="mode.area.pick",Yt="mode.border";class Kt{constructor(){s()(this,"modes",{}),this.registerMode(Jt,[new Y,new H,new U,new $,new mt,new zt]),this.registerMode(Vt,[new G,new $]),this.registerMode($t,[new Y,new $,new Ot,new G]),this.registerMode(qt,[new Y,new $,new Ot((t,e)=>new Gt({sourceNode:t,targetNode:e,arrow:!0})),new G]),this.registerMode(Xt,[new $,new Q,new dt,new zt]),this.registerMode(Yt,[new pt,new $])}registerMode(t,e){this.modes[t]=e}unregisterMode(t){delete this.modes[t]}use(t){return this.modes[t]||[]}hasMode(t){return this.modes.hasOwnProperty(t)}}var Zt=Kt;var Qt=class{constructor(){s()(this,"current",0),s()(this,"delta",0)}update(){const t=("undefined"==typeof performance?Date:performance).now();this.delta=this.current?t-this.current:0,this.current=t}getDelta(){return this.delta}},te=i(6),ee=i.n(te);const ie=["click","dblclick","mousedown","wheel","dragover","drop","contextmenu","mouseenter"];class ne{registerMode(t,e){this.modeManager.registerMode(t,e)}get stage(){return this.rootNode}constructor(t){s()(this,"mounted",!1),s()(this,"_running",!1),s()(this,"_animationFrameId",0),s()(this,"name","application"),s()(this,"eventEmitter",new r),s()(this,"nativeEvent",null),s()(this,"optimize",!0),s()(this,"clock",new Qt),s()(this,"renderType",void 0),s()(this,"interactionMode",Jt),s()(this,"modeManager",new Zt),s()(this,"container",void 0),s()(this,"wrapper",document.createElement("div")),s()(this,"containerClientRect",void 0),s()(this,"graphCanvas",document.createElement("canvas")),s()(this,"graphCanvasCtx",void 0),s()(this,"topCanvas",document.createElement("canvas")),s()(this,"topCanvasMounted",!1),s()(this,"topCanvasCtx",void 0),s()(this,"virtualNode",new T({})),s()(this,"mousedownPosition",new h),s()(this,"mouseupPosition",new h),s()(this,"mousemovePosition",new h),s()(this,"ro",void 0),s()(this,"viewWidth",0),s()(this,"viewHeight",0),s()(this,"canvasWidth",0),s()(this,"canvasHeight",0),s()(this,"canvasScale",void 0),s()(this,"maxScale",void 0),s()(this,"minScale",void 0),s()(this,"repaint",!1),s()(this,"animate",!1),s()(this,"rootNode",new T({id:"rootNode"})),s()(this,"plugins",[]),s()(this,"layout",null),s()(this,"handleNativeEvent",t=>{switch(this.nativeEvent=t,t.type){case"mousedown":{const{clientX:e,clientY:i}=t;this.mousedownPosition.x=e,this.mousedownPosition.y=i,this.getBoundingClientRect();break}case"mousemove":{const{clientY:e,clientX:i}=t;this.mousemovePosition.x=i,this.mousemovePosition.y=e,this.optimizeNode();break}case"mouseup":{const{clientX:e,clientY:i}=t;this.mouseupPosition.x=e,this.mouseupPosition.y=i;break}case"mouseenter":case"drop":this.getBoundingClientRect();break;case"contextmenu":t.preventDefault()}this.plugins.forEach(e=>{e.handleEvent(t)}),this.modeManager.use(this.interactionMode).forEach(e=>{e.handleEvent(this,t)}),this.eventEmitter.emit(t.type,t)}),this.container=t.container,this.wrapper.className=ee.a.topology,this.graphCanvasCtx=this.graphCanvas.getContext("2d"),this.topCanvasCtx=this.topCanvas.getContext("2d"),this.canvasScale=t.scale||1,this.maxScale=t.maxScale||5,this.minScale=t.minScale||.1,this.animate=t.animate||!1,this.renderType=t.renderType||"DOM",this.rootNode.canvas=this,this.virtualNode.maxDepth=!0,this.ro=new _.a((t,e)=>{for(const e of t){const{width:t,height:i}=e.contentRect;this.viewWidth=t,this.viewHeight=i,this.canvasWidth=t/this.canvasScale,this.canvasHeight=i/this.canvasScale,this.getBoundingClientRect()}this.mount(),this.initCanvas(),this.optimizeNode(),this.repaint=!0}),this.ro.observe(this.container),this.nativeEventInit(),this.setMode(t.mode||Jt)}setZoom(t){this.canvasScale=t,this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.initCanvas(),this.optimizeNode(),this.repaint=!0}nativeEventInit(){ie.forEach(t=>{this.wrapper.addEventListener(t,this.handleNativeEvent)}),document.addEventListener("mousemove",this.handleNativeEvent),document.addEventListener("mouseup",this.handleNativeEvent)}destroy(){for(ie.forEach(t=>{this.wrapper.removeEventListener(t,this.handleNativeEvent)}),document.removeEventListener("mousemove",this.handleNativeEvent),document.removeEventListener("mouseup",this.handleNativeEvent),this.ro.unobserve(this.container),this.ro.disconnect(),this.eventEmitter.clear(),this.unmount(),this.removeAllNode();this.plugins.length;){const t=this.plugins.pop();t&&(t.canvas=null,t.destroy())}}addNode(t){this.rootNode.hasChild(t)||(t.visible=t.isInRect(this.canvasVisibleRect),this.rootNode.addChild(t),this.repaint=!0)}setNodeTop(t){const e=t.parent;if(!e)return;const i=e.lastChild&&e.lastChild.zIndex||0;t.zIndex=Math.max(i,t.zIndex),e.removeChild(t,!1),e.addChild(t),t.mount(!0),t.getDescendantBF(t=>{t.mount(!0)}),this.repaint=!0}getActiveNodes(){return this.rootNode.getActiveDescendant()}removeNode(t,e=!0){if(!this.rootNode.hasDescendant(t))return;if(!t.parent)return;t.parent.removeChild(t,e),[...t.edges].forEach(t=>{this.removeEdge(t)}),this.repaint=!0}removeAllNode(t=!0){this.rootNode.removeAllChild(t)}addEdge(t){t.sourceNode.addEdge(t),t.targetNode.addEdge(t),t.canvas=this,this.repaint=!0}removeEdge(t){t.sourceNode.removeEdge(t),t.targetNode.removeEdge(t),t.canvas=void 0,this.repaint=!0}getActiveEdges(){const t=[],e=Math.random();return this.rootNode.getDescendantBF(i=>{i.edges.forEach(i=>{i.renderSign!==e&&(i.renderSign=e,i.active&&t.push(i))})}),t}getBoundingClientRect(){return this.containerClientRect=this.container.getBoundingClientRect(),this.containerClientRect}getContentBoundingRect(){const t=new h(0,0),e=new h(this.canvasWidth,this.canvasHeight);return this.rootNode.getDescendantBF(i=>{const n=i.boundingRect;n[0].x<t.x&&(t.x=n[0].x),n[0].y<t.y&&(t.y=n[0].y),n[2].x>e.x&&(e.x=n[2].x),n[2].y>e.y&&(e.y=n[2].y)}),[t,new h(e.x,t.y),e,new h(t.x,e.y)]}viewportToCanvasCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().substract(new h(i,e))}canvasToViewportCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().add(new h(i,e))}canvasToPixelCoordinate(t){return t.clone().scale(1/this.canvasScale)}pixelToCanvasCoordinate(t){return t.clone().scale(this.canvasScale)}viewportToPixelCoordinate(t){return this.canvasToPixelCoordinate(this.viewportToCanvasCoordinate(t))}pixelToViewportCoordinate(t){return this.canvasToViewportCoordinate(this.pixelToCanvasCoordinate(t))}get canvasVisibleRect(){return[new h(0,0),new h(this.canvasWidth,0),new h(this.canvasWidth,this.canvasHeight),new h(0,this.canvasHeight)]}zoomIn(t){t=t?this.viewportToCanvasCoordinate(t):new h(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale+=.15,this.canvasScale=this.canvasScale>this.maxScale?this.maxScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.initCanvas(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}zoomOut(t){t=t?this.viewportToCanvasCoordinate(t):new h(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale-=.15,this.canvasScale=this.canvasScale<this.minScale?this.minScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.initCanvas(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}setMode(t){this.modeManager.hasMode(t)?(this.modeManager.use(this.interactionMode).forEach(t=>{t.onUninstall(this)}),this.interactionMode=t,this.modeManager.use(this.interactionMode).forEach(t=>{t.onInstall(this)})):console.warn(`该模式不存在:${t}`)}optimizeNode(){if(!this.optimize)return;const t=this.canvasVisibleRect;this.rootNode.getDescendantDF(e=>{e.visible=e.isInRect(t)})}use(t){t.install(this),this.plugins.push(t)}initCanvas(){this.graphCanvas.width=this.topCanvas.width=this.viewWidth,this.graphCanvas.height=this.topCanvas.height=this.viewHeight,Object.assign(this.topCanvas.style,{pointerEvents:"none",zIndex:2}),Object.assign(this.graphCanvas.style,{pointerEvents:"none",zIndex:1})}mount(){this.mounted||(this.wrapper.appendChild(this.graphCanvas),this.container.appendChild(this.wrapper),this.eventEmitter.emit("canvas:mounted"),this.mounted=!0)}unmount(){this.mounted&&(this.container.removeChild(this.wrapper),this.mounted=!1)}topCanvasMount(){this.topCanvasMounted||(this.wrapper.appendChild(this.topCanvas),this.topCanvasMounted=!0)}topCanvasUnmount(){this.topCanvasMounted&&(this.wrapper.removeChild(this.topCanvas),this.topCanvasMounted=!1)}start(){this._running||(this._running=!0,this.loop())}stop(){this._running&&(cancelAnimationFrame(this._animationFrameId),this._running=!1)}loop(){this._running&&(this._animationFrameId=requestAnimationFrame(()=>{if(this.clock.update(),this.repaint||this.animate){this.graphCanvasCtx.clearRect(0,0,this.viewWidth,this.viewHeight),this.graphCanvasCtx.save(),this.graphCanvasCtx.scale(this.canvasScale,this.canvasScale);const t=this.layout&&this.layout.update()||!1;this.render(),this.graphCanvasCtx.restore(),this.modeManager.use(this.interactionMode).forEach(t=>{t.onUpdate(this)}),this.plugins.forEach(t=>{t.enable&&t.update()}),this.repaint=t}this.loop()}))}render(){"CANVAS"===this.renderType?(this.rootNode.getDescendantBF(t=>{const e=t.visible;t.edges.forEach(e=>{if(e.renderSign===this._animationFrameId)return;const i=e.targetNode,n=e.sourceNode;n===t?(t.depth>i.depth||i.renderSign===this._animationFrameId)&&(e.render(),e.renderSign=this._animationFrameId):(t.depth>n.depth||n.renderSign===this._animationFrameId)&&(e.render(),e.renderSign=this._animationFrameId)}),e&&t.update(),t.renderSign=this._animationFrameId}),this.virtualNode.edges.forEach(t=>{t.render()})):(this.virtualNode.edges.forEach(t=>{t.render(this.graphCanvasCtx)}),this.rootNode.getDescendantBF(t=>{t.visible?(t.mount(),t.isUpdate&&(t.update(),t.isUpdate=!1)):t.unmount(),t.renderSign=this._animationFrameId}),this.rootNode.getDescendantDF(t=>{if(t.edges.forEach(t=>{t.renderSign!==this._animationFrameId&&(t.render(this.graphCanvasCtx),t.renderSign=this._animationFrameId)}),N(t)&&t.visible){const{x:e,y:i}=t.getPosition(),n=t.getWidth(),s=t.getHeight();this.graphCanvasCtx.beginPath(),this.graphCanvasCtx.rect(0,0,this.canvasWidth,this.canvasHeight),this.graphCanvasCtx.rect(e,i,n,s),this.graphCanvasCtx.clip("evenodd")}}))}}class se extends f{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"cacheCanvas",document.createElement("canvas"))}render(){const{radius:t,canvas:e,active:i}=this;if(!e)return;const n=2*t;this.cacheCanvas.width=n+2,this.cacheCanvas.height=n+2;const s=this.cacheCanvas.getContext("2d");s.beginPath(),s.arc(t+1,t+1,t,0,2*Math.PI),s.strokeStyle="#29c1f8",s.fillStyle="#fff",s.lineWidth=2,s.stroke(),s.fill(),this.text&&(s.textBaseline="middle",s.textAlign="center",s.font="14px serif",s.fillStyle="#29c1f8",s.fillText(this.text,t+1,t+1)),e.repaint=!0}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,{x:e,y:i}=this.getPosition();t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.drawImage(this.cacheCanvas,e-1,i-1),t.restore()}}var oe=se;class re extends oe{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(t){}update(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const{x:e,y:i}=this.getPosition();t.beginPath(),t.arc(e+this.radius,i+this.radius,this.radius,0,2*Math.PI),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor=this.active?this.style.activeColor:this.style.color),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.stroke(),t.restore()}drawThumbnail(t){const{x:e,y:i}=this.centerPoint;t.save(),t.beginPath(),t.arc(e,i,this.radius,0,2*Math.PI),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}s()(re,"shape","circle");class ae extends wt{constructor(t){super(),s()(this,"image",void 0),"string"==typeof t?(async()=>{try{this.image=await P(t)}catch(t){console.error(t)}})():this.image=t}render(t){if(!this.image)return;const{width:e,height:i}=this.image,{x:n,y:s}=this.position,{x:o,y:r}=this.offset;t.save(),t.translate(n,s),t.rotate(this.rotate),t.translate(o,r),t.drawImage(this.image,-e/2,-i/2),t.restore()}isPointIn(t){if(!this.image)return!1;const{width:e,height:i}=this.image,n=new h(-e/2,-i/2).add(this.offset).rotate(this.rotate),s=new h(-e/2,+i/2).add(this.offset).rotate(this.rotate),o=new h(+e/2,+i/2).add(this.offset).rotate(this.rotate),r=new h(+e/2,-i/2).add(this.offset).rotate(this.rotate);return p.isPointInPolygon(h.copy(t).substract(this.position),[n,s,o,r])}}const he=new h,ce=new h,de=new h;class ue extends nt{get width(){return this.canvasElement.width}set width(t){this.canvasElement.width=t}get height(){return this.canvasElement.height}set height(t){this.canvasElement.height=t}constructor(t=200,e=200){super(),s()(this,"canvasElement",document.createElement("canvas")),s()(this,"handleMouseMove",E(t=>{if(1!==t.buttons||!this.canvas||0===he.magnitude)return he.x=t.offsetX,void(he.y=t.offsetY);ce.x=t.offsetX,ce.y=t.offsetY;const e=this.canvas.getContentBoundingRect(),i=e[2].x-e[0].x,n=e[2].y-e[0].y,s=Math.max(i/this.width,n/this.height);de.copy(ce).substract(he).scale(-s),this.canvas.rootNode.translate(de),this.canvas.repaint=!0,he.copy(ce)})),this.canvasElement.width=t,this.canvasElement.height=e,this.canvasElement.draggable=!1}install(t){this.canvas=t,this.canvasElement.addEventListener("mousemove",this.handleMouseMove)}destroy(){this.canvasElement.removeEventListener("mousemove",this.handleMouseMove),this.canvas=null}update(){this.render()}render(){if(!this.canvas)return;const t=this.canvas.getContentBoundingRect(),e=t[2].x-t[0].x,i=t[2].y-t[0].y,n=Math.min(this.width/e,this.height/i),s=this.canvasElement.getContext("2d"),o=(this.width/n-e)/2-t[0].x,r=(this.height/n-i)/2-t[0].y;s.clearRect(0,0,this.width,this.height),s.save(),s.scale(n,n),s.translate(o,r);const a=Math.random();this.canvas.rootNode.getDescendantBF(t=>{t.edges.forEach(e=>{e.renderSign!==a&&(e.sourceNode===t?e.targetNode.depth<=t.depth&&(e.drawThumbnail(s),e.renderSign=a):e.sourceNode.depth<=t.depth&&(e.drawThumbnail(s),e.renderSign=a))}),t.miniMapVisible&&t.drawThumbnail(s)}),s.translate(-o,-r),s.beginPath(),s.rect(0,0,this.width/n,this.height/n),s.rect(o,r,this.canvas.canvasWidth,this.canvas.canvasHeight),s.fillStyle="rgba(0,0,0,0.3)",s.fill("evenodd"),s.beginPath(),s.rect(o,r,this.canvas.canvasWidth,this.canvas.canvasHeight),s.strokeStyle="#29c1f8",s.lineWidth=1/n,s.stroke(),s.restore()}mount(t){t.appendChild(this.canvasElement)}unmount(){this.canvasElement.parentElement&&this.canvasElement.parentElement.removeChild(this.canvasElement)}}class le{constructor(){s()(this,"destination",new h),s()(this,"distance",new h),s()(this,"speed",new h),s()(this,"node",null),s()(this,"duration",0),s()(this,"pass",0),s()(this,"complete",!1)}update(t){if(!this.node||this.complete)return;this.pass+=t;const e=this.duration>this.pass?this.duration-this.pass:0;this.distance.copy(this.destination).substract(this.node.centerPoint),t<e?this.distance.magnitude>1?(this.speed.copy(this.distance).scale(1/e*t),this.node.translate(this.speed)):this.complete=!0:(this.node.translate(this.distance),this.complete=!0)}}var ve=class{constructor(t){s()(this,"canvas",void 0),s()(this,"transports",[]),this.canvas=t}update(){const t=this.transports.filter(t=>!t.complete);if(this.canvas.optimizeNode(),!t.length)return!1;const e=this.canvas.clock.getDelta();return t.forEach(t=>t.update(e)),!0}};const pe=2*Math.PI;class ge extends ve{constructor(...t){super(...t),s()(this,"clockwise",!0),s()(this,"radius",0),s()(this,"startAngle",0),s()(this,"endAngle",2*Math.PI),s()(this,"duration",0),s()(this,"gap",10),s()(this,"nodeRadius",50)}layout(){this.canvas.layout=this;const t=this.canvas.rootNode.children,e=t.length;if(0===e)return;this.transports=[];let i=Math.abs(this.endAngle-this.startAngle),n=0,s=0,o=this.radius;if(i>0)n=Math.ceil(i/pe),s=Math.ceil(e/(i/pe)),o=(this.nodeRadius+this.gap/2)/Math.sin(1===n?i/e/2:pe/s/2);else if(o>0){const t=2*Math.asin((this.nodeRadius+this.gap/2)/o);s=Math.floor(pe/t),n=Math.ceil(e/s),i=pe/s*e}else i=pe,n=1,s=e,o=(this.nodeRadius+this.gap/2)/Math.sin(i/e/2);const r=new h(this.canvas.canvasWidth/2,this.canvas.canvasHeight/2);for(let a=1;a<=n;a++)for(let c=1;c<=s;c++){const d=t[(a-1)*s+c-1];if(!d)break;const u=new le;this.transports.push(u),u.node=d,u.duration=this.duration,u.destination.copy(h.xAxis);const l=o+(a-1)*(2*this.nodeRadius+this.gap);if(a===n){const t=i%pe||pe,n=e%s||s,o=(t===pe?t/n:t/(n-1||2))*(c%n),a=this.startAngle+(this.clockwise?o:-o);u.destination.scale(l).rotate(a).add(r)}else{const t=pe/s*(c-1),e=this.startAngle+(this.clockwise?t:-t);u.destination.scale(l).rotate(e).add(r)}}this.canvas.repaint=!0}}class fe extends ve{constructor(...t){super(...t),s()(this,"rows",0),s()(this,"rowGap",10),s()(this,"columns",0),s()(this,"columnGap",10),s()(this,"nodeRadius",50),s()(this,"duration",0),s()(this,"transports",[])}layout(){this.canvas.layout=this;const t=this.canvas.rootNode.children,e=t.length;if(0===e)return;this.transports=[];let i=0,n=0;this.rows>0?(i=this.rows,n=Math.ceil(e/i)):this.columns>0?(n=this.columns,i=Math.ceil(e/n)):(i=Math.ceil(Math.sqrt(e)),n=Math.ceil(e/i));const s=n*this.nodeRadius*2+(n-1)*this.columnGap,o=i*this.nodeRadius*2+(i-1)*this.rowGap,r=new h((this.canvas.canvasWidth-s)/2+this.nodeRadius,(this.canvas.canvasHeight-o)/2+this.nodeRadius);for(let e=1;e<=i;e++)for(let i=1;i<=n;i++){const s=t[(e-1)*n+i-1];if(!s)break;const o=new le;o.node=s,o.destination.copy(r),o.destination.x+=(i-1)*(2*this.nodeRadius+this.columnGap),o.destination.y+=(e-1)*(2*this.nodeRadius+this.rowGap),o.duration=this.duration,this.transports.push(o)}this.canvas.repaint=!0}}class me extends le{constructor(...t){super(...t),s()(this,"M",1),s()(this,"Q",32),s()(this,"force",new h),s()(this,"accelerate",new h)}update(){this.node&&(this.accelerate.copy(this.force).scale(1/this.M),this.speed.add(this.accelerate),this.node.translate(this.speed))}}const xe=30;class we extends ve{constructor(...t){super(...t),s()(this,"transports",[]),s()(this,"elasticity",.01),s()(this,"attractive",.005),s()(this,"repulsion",20),s()(this,"damping",.1),s()(this,"edgeLength",100),s()(this,"complete",!1),s()(this,"animate",!0)}layout(){this.canvas.layout=this;const t=this.canvas.rootNode.children;0!==t.length&&(this.complete=!1,this.transports=t.map(t=>{const e=new me;return e.node=t,e}),this.canvas.repaint=!0)}update(){if(this.complete)return!1;this.calculateForce();let t=!0;return this.transports.forEach(e=>{e.update(),t&&(t=t&&e.speed.magnitude<.1)}),this.complete=t,this.canvas.optimizeNode(),!!this.animate||this.update()}calculateForce(){const t=new h(this.canvas.canvasWidth/2,this.canvas.canvasHeight/2);this.transports.forEach(e=>{const i=e.node;e.force.x=0,e.force.y=0,this.transports.forEach(t=>{if(e===t)return;const n=t.node,s=i.centerPoint.substract(n.centerPoint);let o=s.magnitude;o=o<xe?xe:o;const r=e.Q*t.Q/o**2*this.repulsion,a=s.normalize().scale(r);e.force.add(a)}),i.edges.forEach(t=>{let n=t.sourceNode===i?t.targetNode:t.sourceNode;if("NONE"===n.renderType)return;const s=n.centerPoint.substract(i.centerPoint);let o=s.magnitude;o=o>this.edgeLength?o-this.edgeLength:this.edgeLength;const r=o*this.elasticity,a=s.normalize().scale(r);e.force.add(a)});{const t=e.speed.magnitude*this.damping,i=e.speed.clone().normalize().scale(-t);e.force.add(i)}const n=t.clone().substract(i.centerPoint),s=n.magnitude*this.attractive,o=n.normalize().scale(s);e.force.add(o)})}}i.d(e,"Canvas",(function(){return ne})),i.d(e,"EventEmitter",(function(){return o})),i.d(e,"Edge",(function(){return xt})),i.d(e,"Node",(function(){return u})),i.d(e,"MODE_DEFAULT",(function(){return Jt})),i.d(e,"MODE_VIEW",(function(){return Vt})),i.d(e,"MODE_CREATE_EDGE",(function(){return $t})),i.d(e,"MODE_CREATE_L",(function(){return qt})),i.d(e,"MODE_AREA_PICK",(function(){return Xt})),i.d(e,"MODE_BORDER",(function(){return Yt})),i.d(e,"ModeManager",(function(){return Kt})),i.d(e,"Interaction",(function(){return R})),i.d(e,"SelectInteraction",(function(){return q})),i.d(e,"selectInteraction",(function(){return X})),i.d(e,"DragInteraction",(function(){return D})),i.d(e,"dragInteraction",(function(){return O})),i.d(e,"DropInteraction",(function(){return z})),i.d(e,"dropInteraction",(function(){return B})),i.d(e,"MoveCanvasInteraction",(function(){return j})),i.d(e,"moveCanvasInteraction",(function(){return F})),i.d(e,"WheelZoomInteraction",(function(){return J})),i.d(e,"wheelZoomInteraction",(function(){return V})),i.d(e,"AreaPickInteraction",(function(){return K})),i.d(e,"areaPickInteraction",(function(){return Z})),i.d(e,"CreateGroupInteraction",(function(){return ht})),i.d(e,"createGroupInteraction",(function(){return ct})),i.d(e,"CreateEdgeInteraction",(function(){return Wt})),i.d(e,"ResizeInteraction",(function(){return lt})),i.d(e,"resizeInteraction",(function(){return vt})),i.d(e,"CollapseAndExpandInteraction",(function(){return gt})),i.d(e,"collapseAndExpandInteraction",(function(){return ft})),i.d(e,"ManualAlignInteraction",(function(){return Ht})),i.d(e,"RectDomNode",(function(){return w})),i.d(e,"RectCanvasNode",(function(){return tt})),i.d(e,"CircleCanvasNode",(function(){return se})),i.d(e,"RectCanvasGroup",(function(){return et})),i.d(e,"RectDomGroup",(function(){return b})),i.d(e,"CircleCanvasGroup",(function(){return re})),i.d(e,"Line",(function(){return Rt})),i.d(e,"L",(function(){return Ft})),i.d(e,"Math2d",(function(){return v})),i.d(e,"Vector2d",(function(){return a})),i.d(e,"throttle",(function(){return E})),i.d(e,"imgLoad",(function(){return P})),i.d(e,"applyMixins",(function(){return M})),i.d(e,"isRectNode",(function(){return N})),i.d(e,"isCircleNode",(function(){return A})),i.d(e,"isRectDomGroup",(function(){return I})),i.d(e,"Img",(function(){return ae})),i.d(e,"Rect",(function(){return Ct})),i.d(e,"Text",(function(){return Mt})),i.d(e,"Triangle",(function(){return yt})),i.d(e,"Polyline",(function(){return It})),i.d(e,"MiniMap",(function(){return ue})),i.d(e,"ContextMenu",(function(){return rt})),i.d(e,"CircularLayout",(function(){return ge})),i.d(e,"MatrixLayout",(function(){return fe})),i.d(e,"ForceLayout",(function(){return we}))}])}));